<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* ===== RESET ===== */
* { box-sizing:border-box; margin:0; padding:0; }
body {font-family: Arial, sans-serif; background:#f4f6f8;}
.container {width:95%; max-width:900px; margin:auto;}
.logo-login {width:150px; margin:20px auto; display:block;}
h2 {text-align:center; margin-bottom:20px;}

/* ===== INPUT & BUTTON ===== */
input, button {width:85%; max-width:420px; display:block; margin:10px auto; padding:12px; font-size:1.1rem; border-radius:6px; border:1px solid #ccc;}
button {background:#6a1b9a; color:white; border:none; font-weight:bold; cursor:pointer; transition:0.2s;}
button:hover {background:white; color:#6a1b9a; border:2px solid #6a1b9a;}

/* ===== TABS LOGIN/REG ===== */
#authTabs {display:flex; justify-content:center; gap:10px; margin-bottom:20px;}
.tabButton {flex:1; padding:10px; background:#6a1b9a; color:white; border:none; border-radius:6px; font-weight:bold; cursor:pointer; transition:0.2s;}
.tabButton:hover {background:white; color:#6a1b9a; border:2px solid #6a1b9a;}
.tabButton.active {background:white; color:#6a1b9a; border:2px solid #6a1b9a;}

/* ===== MOSTRA PASSWORD ===== */
.password-toggle {width:85%; max-width:420px; margin:10px auto; display:flex; gap:10px; align-items:center; font-size:1rem;}
.password-toggle input[type="checkbox"] {margin:0; cursor:pointer;}

/* ===== PASSWORD DIMENTICATA ===== */
.forgot-password {text-align:center; margin-top:10px;}
.forgot-password a {color:#6a1b9a; font-weight:bold; text-decoration:none;}
.forgot-password a:hover {text-decoration:underline;}
</style>
</head>

<body>
<div class="container" id="loginPage">
  <img src="https://drive.google.com/thumbnail?id=1gozdQWrZKRs7PLNRrW-td4Ky4ehhhjmj&sz=w200" class="logo-login">
  <h2>Registrati o effettua l'accesso</h2>

  <div id="authTabs">
    <button class="tabButton active" onclick="showAuthTab('login')">LOGIN</button>
    <button class="tabButton" onclick="showAuthTab('register')">REGISTRATI</button>
  </div>

  <!-- LOGIN FORM -->
  <div id="loginForm">
    <input type="email" id="login_email" placeholder="Email">
    <input type="password" id="login_pass" placeholder="Password">
    <div class="password-toggle">
      <input type="checkbox" onclick="togglePassword('login_pass')"> Mostra password
    </div>
    <button onclick="login()">Accedi</button>
    <p class="forgot-password">
      <a href="#" onclick="forgotPassword()">Password dimenticata?</a>
    </p>
  </div>

  <!-- REGISTER FORM -->
  <div id="registerForm" style="display:none;">
    <input type="text" id="reg_nome" placeholder="Nome">
    <input type="text" id="reg_cognome" placeholder="Cognome">
    <input type="email" id="reg_email" placeholder="Email">
    <input type="password" id="reg_pass" placeholder="Password">
    <input type="password" id="reg_pass_confirm" placeholder="Conferma Password">
    <div class="password-toggle">
      <input type="checkbox" onclick="togglePassword('reg_pass','reg_pass_confirm')"> Mostra password
    </div>
    <button onclick="register()">Registrati</button>
  </div>
</div>

<script>
let currentUser = null;

async function apiFetch(endpoint, method='POST', body={}) {
  const res = await fetch(endpoint, {
    method,
    headers:{'Content-Type':'application/json'},
    body: method==='POST' ? JSON.stringify(body) : undefined
  });
  return res.json();
}

async function login(){
  const email = document.getElementById('login_email').value;
  const password = document.getElementById('login_pass').value;
  const res = await apiFetch('/api/login','POST',{email,password});
  if(res.ok){
    localStorage.setItem('currentUser', JSON.stringify({email, nome:res.nome, ruolo:res.ruolo}));
    window.location.href='/app.html';
  } else alert(res.msg);
}

async function register(){
  const res = await apiFetch('/api/register','POST',{
    email:document.getElementById('reg_email').value,
    nome:document.getElementById('reg_nome').value,
    cognome:document.getElementById('reg_cognome').value,
    password:document.getElementById('reg_pass').value,
    passwordConfirm:document.getElementById('reg_pass_confirm').value
  });
  alert(res.msg);
  if(res.ok) window.location.href='/app.html';
}

function forgotPassword(){ alert("Gestita lato server"); }

function showAuthTab(tab){
  const loginForm = document.getElementById('loginForm');

