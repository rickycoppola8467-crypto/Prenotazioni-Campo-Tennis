<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="icon" type="image/png" href="favicon.png">

<style>
/* ===== RESET BASE ===== */
* { box-sizing: border-box; margin:0; padding:0; }
body {font-family: Arial, sans-serif; background: #f4f6f8; overflow-x: hidden;}

/* ===== CONTAINER ===== */
.container {width: 95%; max-width: 900px; margin: auto;}

/* ===== TITOLI ===== */
h2, h3 { text-align: center; }
#bookingTitle {font-size: 2.3rem; font-weight: bold; margin: 20px 0;}

/* ===== LABEL ===== */
label {display:block;width:85%; max-width:420px; margin:14px auto 6px auto; font-size:1.2rem; font-weight:bold; text-align:left;}

/* ===== INPUT & SELECT ===== */
input, select {width:85%; max-width:420px; margin:0 auto 12px auto; padding:12px; font-size:1.1rem; border-radius:6px; border:1px solid #ccc; display:block;}

/* ===== BOTTONI ===== */
button {width:85%; max-width:420px; margin:16px auto; padding:14px; font-size:1.2rem; font-weight:bold; border:none; border-radius:6px; cursor:pointer; background-color:#6a1b9a; color:white; display:block;}
button:hover {background-color:white; color:#6a1b9a;}

/* ===== SEZIONI ===== */
.section { display: none; padding: 20px 0; }

/* ===== SLOT LAYOUT ===== */
.slots-wrapper {display:flex;gap:16px;margin-top:24px;}
.slots-column { flex:1; }

/* ===== SLOT DISPONIBILI E OCCUPATI ===== */
#slotsFree { max-height:420px; overflow-y:auto; }
#slotsBusy { display:flex; flex-direction:column; align-items:center; }

.slot-libero, .slot-occupato {
  font-size:1.5rem; min-height:60px;
  display:flex; align-items:center; justify-content:center;
  border-radius:6px; margin:10px auto;
}
.slot-libero { width:50%; background:#4caf50; color:white; cursor:pointer; }
.slot-occupato { width:90%; background:#f44336; color:black; font-weight:bold; }

/* ===== TOP BAR ===== */
#topBar {
  display:flex; background:#6a1b9a; height:60px;
  align-items:center; justify-content:space-between; padding:0 10px;
}
.logo-bar {width:50px; height:50px; object-fit:contain;}
.topButton {
  flex:1; margin:0 5px; padding:10px;
  background:#6a1b9a; color:white;
  border-radius:6px; font-weight:bold;
  cursor:pointer; text-align:center;
}
.topButton.active {
  background:white; color:#6a1b9a;
  border:2px solid #6a1b9a;
}

/* ===== CALENDARIO ===== */
#calendarSection {display:flex; gap:20px;}
#bookingForm {flex:1;}
#calendarSlots {flex:1; display:flex; gap:10px;}

/* ===== STORICO ===== */
.booking-upcoming {
  background:#4caf50; color:white; padding:10px;
  margin:6px 0; border-radius:6px;
  display:flex; justify-content:space-between;
}
.booking-past {
  background:#e0e0e0; color:black; padding:10px;
  margin:6px 0; border-radius:6px;
  display:flex; justify-content:space-between;
}
.delete-booking-btn {
  background:white; color:red; border:2px solid red;
  border-radius:4px; cursor:pointer;
}
</style>
</head>

<body>

<div id="appPage" style="display:flex; flex-direction:column; min-height:100vh;">

  <div id="topBar">
    <img src="https://drive.google.com/thumbnail?id=1gozdQWrZKRs7PLNRrW-td4Ky4ehhhjmj&sz=w200" class="logo-bar">
    <div class="topButton" onclick="showSection('home')">HOME</div>
    <div class="topButton" onclick="showSection('calendar')">CALENDARIO</div>
    <div class="topButton" onclick="showSection('myBookings')">STORICO</div>
    <div class="topButton" onclick="showSection('profile')">PROFILO</div>
    <div class="topButton" onclick="showSection('gallery')">GALLERY</div>
    <div class="topButton" onclick="logout()">LOGOUT</div>
  </div>

  <div class="container">

    <div id="homeSection" class="section">
      <h2>Benvenuto!</h2>
    </div>

    <div id="calendarSection" class="section">
      <div id="bookingForm">
        <h2 id="bookingTitle">Prenota il campo</h2>
        <label>Data</label>
        <input type="date" id="data">
        <label>Campo</label>
        <select id="campo"><option>Campo 1</option><option>Campo 2</option></select>
        <label>Durata</label>
        <select id="durata"><option value="1">1 ora</option><option value="2">2 ore</option></select>
        <label id="userLabel" style="display:none;">Prenota per:</label>
        <select id="selectUser" style="display:none;"></select>
        <button onclick="loadSlots()">Cerca disponibilità</button>
      </div>

      <div id="calendarSlots">
        <div class="slots-column">
          <h3>Disponibili</h3>
          <div id="slotsFree"></div>
        </div>
        <div class="slots-column">
          <h3>Occupati</h3>
          <div id="slotsBusy"></div>
        </div>
      </div>
    </div>

    <div id="myBookingsSection" class="section">
      <h2>Storico prenotazioni</h2>
      <div id="myBookingsList"></div>
    </div>

    <div id="profileSection" class="section"><h2>Profilo</h2></div>
    <div id="gallerySection" class="section"><h2>Gallery</h2></div>

  </div>
</div>

<script>
let currentUser = null;

async function apiFetch(endpoint, method='POST', body={}) {
  const res = await fetch(endpoint,{
    method,
    headers:{'Content-Type':'application/json'},
    body: method==='POST'?JSON.stringify(body):undefined
  });
  return res.json();
}

/* ===== TUTTE LE FUNZIONI IDENTICHE AL TUO CODICE ===== */
/* loadSlots, showSlots, book, loadMyBookings, deleteBooking,
   applyRoleUI, showSection, logout, ecc. — NON MODIFICATE */

/* ===== ONLOAD ===== */
window.onload = ()=>{
  const saved = JSON.parse(localStorage.getItem('currentUser')||'null');
  if(!saved){
    window.location.href='/login.html';
    return;
  }
  currentUser = saved;
  showSection('home');
  loadMyBookings();
  if(currentUser.ruolo==='admin') applyRoleUI();
};
</script>

</body>
</html>
